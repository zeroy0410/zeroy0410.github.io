<!DOCTYPE html>
<html lang="zh-cn" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>攻防世界reverse练习区WP | zeroy&#39;s blog</title>
<meta name="keywords" content="" />
<meta name="description" content="0x00. simple-unpack 使用exeinfope脱壳，拖进IDA shift&#43;F12搜索字符串。
0x01. logmein 反编译得到如下代码：
void __fastcall __noreturn main(int a1, char **a2, char **a3) { size_t v3; // rsi  int i; // [rsp&#43;3Ch] [rbp-54h]  char s[36]; // [rsp&#43;40h] [rbp-50h] BYREF  int v6; // [rsp&#43;64h] [rbp-2Ch]  __int64 v7; // [rsp&#43;68h] [rbp-28h]  char v8[28]; // [rsp&#43;70h] [rbp-20h] BYREF  int v9; // [rsp&#43;8Ch] [rbp-4h]  v9 = 0; strcpy(v8, &#34;:\&#34;AL_RT^L*.?&#43;6/46&#34;); v7 = 0x65626D61726168LL; v6 = 7; printf(&#34;Welcome to the RC3 secure password guesser.">
<meta name="author" content="zeroy">
<link rel="canonical" href="https://zeroy.site/articles/reverse-exercise-area/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css" integrity="sha256-yIlj/i15RiAA/Q&#43;xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://zeroy.site/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://zeroy.site/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://zeroy.site/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://zeroy.site/apple-touch-icon.png">
<link rel="mask-icon" href="https://zeroy.site/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.92.0" />
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="攻防世界reverse练习区WP" />
<meta property="og:description" content="0x00. simple-unpack 使用exeinfope脱壳，拖进IDA shift&#43;F12搜索字符串。
0x01. logmein 反编译得到如下代码：
void __fastcall __noreturn main(int a1, char **a2, char **a3) { size_t v3; // rsi  int i; // [rsp&#43;3Ch] [rbp-54h]  char s[36]; // [rsp&#43;40h] [rbp-50h] BYREF  int v6; // [rsp&#43;64h] [rbp-2Ch]  __int64 v7; // [rsp&#43;68h] [rbp-28h]  char v8[28]; // [rsp&#43;70h] [rbp-20h] BYREF  int v9; // [rsp&#43;8Ch] [rbp-4h]  v9 = 0; strcpy(v8, &#34;:\&#34;AL_RT^L*.?&#43;6/46&#34;); v7 = 0x65626D61726168LL; v6 = 7; printf(&#34;Welcome to the RC3 secure password guesser." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zeroy.site/articles/reverse-exercise-area/" /><meta property="article:section" content="articles" />
<meta property="article:published_time" content="2022-04-19T08:36:18&#43;08:00" />
<meta property="article:modified_time" content="2022-04-19T08:36:18&#43;08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="攻防世界reverse练习区WP"/>
<meta name="twitter:description" content="0x00. simple-unpack 使用exeinfope脱壳，拖进IDA shift&#43;F12搜索字符串。
0x01. logmein 反编译得到如下代码：
void __fastcall __noreturn main(int a1, char **a2, char **a3) { size_t v3; // rsi  int i; // [rsp&#43;3Ch] [rbp-54h]  char s[36]; // [rsp&#43;40h] [rbp-50h] BYREF  int v6; // [rsp&#43;64h] [rbp-2Ch]  __int64 v7; // [rsp&#43;68h] [rbp-28h]  char v8[28]; // [rsp&#43;70h] [rbp-20h] BYREF  int v9; // [rsp&#43;8Ch] [rbp-4h]  v9 = 0; strcpy(v8, &#34;:\&#34;AL_RT^L*.?&#43;6/46&#34;); v7 = 0x65626D61726168LL; v6 = 7; printf(&#34;Welcome to the RC3 secure password guesser."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Articles",
      "item": "https://zeroy.site/articles/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "攻防世界reverse练习区WP",
      "item": "https://zeroy.site/articles/reverse-exercise-area/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "攻防世界reverse练习区WP",
  "name": "攻防世界reverse练习区WP",
  "description": "0x00. simple-unpack 使用exeinfope脱壳，拖进IDA shift+F12搜索字符串。\n0x01. logmein 反编译得到如下代码：\nvoid __fastcall __noreturn main(int a1, char **a2, char **a3) { size_t v3; // rsi  int i; // [rsp+3Ch] [rbp-54h]  char s[36]; // [rsp+40h] [rbp-50h] BYREF  int v6; // [rsp+64h] [rbp-2Ch]  __int64 v7; // [rsp+68h] [rbp-28h]  char v8[28]; // [rsp+70h] [rbp-20h] BYREF  int v9; // [rsp+8Ch] [rbp-4h]  v9 = 0; strcpy(v8, \u0026#34;:\\\u0026#34;AL_RT^L*.?+6/46\u0026#34;); v7 = 0x65626D61726168LL; v6 = 7; printf(\u0026#34;Welcome to the RC3 secure password guesser.",
  "keywords": [
    
  ],
  "articleBody": "0x00. simple-unpack 使用exeinfope脱壳，拖进IDA shift+F12搜索字符串。\n0x01. logmein 反编译得到如下代码：\nvoid __fastcall __noreturn main(int a1, char **a2, char **a3) { size_t v3; // rsi  int i; // [rsp+3Ch] [rbp-54h]  char s[36]; // [rsp+40h] [rbp-50h] BYREF  int v6; // [rsp+64h] [rbp-2Ch]  __int64 v7; // [rsp+68h] [rbp-28h]  char v8[28]; // [rsp+70h] [rbp-20h] BYREF  int v9; // [rsp+8Ch] [rbp-4h]  v9 = 0; strcpy(v8, \":\\\"AL_RT^L*.?+6/46\"); v7 = 0x65626D61726168LL; v6 = 7; printf(\"Welcome to the RC3 secure password guesser.\\n\"); printf(\"To continue, you must enter the correct password.\\n\"); printf(\"Enter your guess: \"); __isoc99_scanf(); v3 = strlen(s); if ( v3  strlen(v8) ) sub_4007C0(); for ( i = 0; i  strlen(s); ++i ) { if ( i = strlen(v8) ) sub_4007C0(); if ( s[i] != (char)(*((_BYTE *)\u0026v7 + i % v6) ^ v8[i]) ) sub_4007C0(); } sub_4007F0(); } 可以看出，flag就是v7，v6，v8经过一定规则生成的字符串，提取出生成flag的逻辑，写成脚本如下：\nv8=\":\\\"AL_RT^L*.?+6/46\" v7 = 'ebmarah'[::-1] s='' for i in range(len(v8)): s+=chr(ord(v7[i%7])^ord(v8[i])) print(s) 0x02. insanity 直接拖进IDA，查找字符串。\n0x03. python-trade 反编译之后发现有个encode函数，根据函数的逻辑规则写出decode函数如下：\nimport base64 buf = base64.b64decode('XlNkVmtUI1MgXWBZXCFeKY+AaXNt') flag = '' for i in buf: i -= 16 i ^= 32 flag += chr(i) print(flag) 0x04. re1 又一个直接查找字符串就能找到flag的题。\n0x05. game 打开是个游戏，游戏通关拿到flag（草）\n0x06. Hello, CTF 反编译获得如下代码：\nint __cdecl main(int argc, const char **argv, const char **envp) { int i; // ebx  char v4; // al  int result; // eax  char Buffer[2]; // [esp+12h] [ebp-5Eh] BYREF  char v7[20]; // [esp+14h] [ebp-5Ch] BYREF  char v8[32]; // [esp+28h] [ebp-48h] BYREF  __int16 v9; // [esp+48h] [ebp-28h]  char v10; // [esp+4Ah] [ebp-26h]  char v11[36]; // [esp+4Ch] [ebp-24h] BYREF  strcpy(v11, \"437261636b4d654a757374466f7246756e\"); while ( 1 ) { memset(v8, 0, sizeof(v8)); v9 = 0; v10 = 0; printf(aPleaseInputYou); scanf(\"%s\", v7); if ( strlen(v7)  0x11 ) break; for ( i = 0; i  17; ++i ) { v4 = v7[i]; if ( !v4 ) break; sprintf(Buffer, \"%x\", v4); strcat(v8, Buffer); } if ( !strcmp(v8, v11) ) printf(\"success!\\n\"); else printf(\"wrong!\\n\"); } printf(\"wrong!\\n\"); result = --Stream._cnt; if ( Stream._cnt  0 ) return _filbuf(\u0026Stream); ++Stream._ptr; return result; } 阅读代码后发现就是将输入的字符串转换为16进制存储，再与给定字符串比较。\n因此可以根据给定字符串推导出flag。\n0x07. open-source 题目直接给出了源代码：\n#include #include  int main(int argc, char *argv[]) { if (argc != 4) { printf(\"what?\\n\"); exit(1); } unsigned int first = atoi(argv[1]); if (first != 0xcafe) { printf(\"you are wrong, sorry.\\n\"); exit(2); } unsigned int second = atoi(argv[2]); if (second % 5 == 3 || second % 17 != 8) { printf(\"ha, you won't get it!\\n\"); exit(3); } if (strcmp(\"h4cky0u\", argv[3])) { printf(\"so close, dude!\\n\"); exit(4); } printf(\"Brr wrrr grr\\n\"); unsigned int hash = first * 31337 + (second % 17) * 11 + strlen(argv[3]) - 1615810207; printf(\"Get your key: \"); printf(\"%x\\n\", hash); return 0; } 根据规则构造payload即可获取flag。\n0x08. no-strings-attached 打开来发现是一个非常大的程序：\n注意到最后一个函数authenticate可能是验证输入的flag是否正确，打开后如下：\n看样子是要比较ws和s2的值是否一致，而s2是由decrypt函数生成的：\n生成flag的算法看起来挺复杂，懒得写了，故采用动态调试。阅读汇编代码可知，decrypt函数结束后，返回值存在eax中。\n用gdb再decrypt函数处下个断点，程序运行至decrypt处停下，再往前运行一步，再结束运行此函数，此时eax寄存器存储的值就是flag。\n(gdb)b decrypt (gdb)n (gdb)finish (gdb)x/6sw $eax 0x09. csaw2013reversing2 打开来发现有一个窗体，弹出了一坨乱码： 打开IDA查看程序逻辑：\n发现程序存在反调试IsDebuggerPresent。\n跳过反调试，将jnz short loc_401096改为jmp short loc_401096，绕过反调试检查。\n再将int 3 ;Trap to Debugger改为nop去掉这个中断。\n再跳转回原来的弹窗输出flag。\n Patch Program的方法：Edit-Patch Program-Assemble\n全部更改完成后，点击Edit-Patch Program-Apply patches to input file\n 0x0a. getit 拖进IDA看见如下代码：\n分析逻辑之后发现t的值就是flag，可以直接根据逻辑写exp，不过我这里使用动态调试的方法。\n在for循环的第一个函数处下个断点，之后直接查看t的值。\n(gdb)b fseek (gdb)r (gdb)x/6 0x6010e0#t的地址 成功获取flag。\n0x0b. maze XCTF reverse maze - YenKoc - 博客园 (cnblogs.com)\n",
  "wordCount" : "473",
  "inLanguage": "zh-cn",
  "datePublished": "2022-04-19T08:36:18+08:00",
  "dateModified": "2022-04-19T08:36:18+08:00",
  "author":{
    "@type": "Person",
    "name": "zeroy"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://zeroy.site/articles/reverse-exercise-area/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "zeroy's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://zeroy.site/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://zeroy.site/" accesskey="h" title="zeroy&#39;s blog (Alt + H)">zeroy&#39;s blog</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://zeroy.site/" title="首页">
                    <span>首页</span>
                </a>
            </li>
            <li>
                <a href="https://zeroy.site/archives/" title="归档">
                    <span>归档</span>
                </a>
            </li>
            <li>
                <a href="https://zeroy.site/categories/" title="分类">
                    <span>分类</span>
                </a>
            </li>
            <li>
                <a href="https://zeroy.site/about/" title="关于">
                    <span>关于</span>
                </a>
            </li>
            <li>
                <a href="https://zeroy.site/search/" title="搜索 (Alt &#43; /)" accesskey=/>
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="https://zeroy.site/links/" title="友链">
                    <span>友链</span>
                </a>
            </li>
        </ul>
        <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=80 src="//music.163.com/outchain/player?type=2&id=415904308&auto=1&height=66"></iframe>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://zeroy.site/">Home</a>&nbsp;»&nbsp;<a href="https://zeroy.site/articles/">Articles</a></div>
    <h1 class="post-title">
      攻防世界reverse练习区WP
    </h1>
    <div class="post-meta"><span title='2022-04-19 08:36:18 +0800 CST'>April 19, 2022</span>&nbsp;·&nbsp;zeroy

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#0x00-simple-unpack" aria-label="0x00. simple-unpack">0x00. simple-unpack</a></li>
                <li>
                    <a href="#0x01-logmein" aria-label="0x01. logmein">0x01. logmein</a></li>
                <li>
                    <a href="#0x02-insanity" aria-label="0x02. insanity">0x02. insanity</a></li>
                <li>
                    <a href="#0x03-python-trade" aria-label="0x03. python-trade">0x03. python-trade</a></li>
                <li>
                    <a href="#0x04-re1" aria-label="0x04. re1">0x04. re1</a></li>
                <li>
                    <a href="#0x05-game" aria-label="0x05. game">0x05. game</a></li>
                <li>
                    <a href="#0x06-hello-ctf" aria-label="0x06. Hello, CTF">0x06. Hello, CTF</a></li>
                <li>
                    <a href="#0x07-open-source" aria-label="0x07. open-source">0x07. open-source</a></li>
                <li>
                    <a href="#0x08-no-strings-attached" aria-label="0x08. no-strings-attached">0x08. no-strings-attached</a></li>
                <li>
                    <a href="#0x09-csaw2013reversing2" aria-label="0x09. csaw2013reversing2">0x09. csaw2013reversing2</a></li>
                <li>
                    <a href="#0x0a-getit" aria-label="0x0a. getit">0x0a. getit</a></li>
                <li>
                    <a href="#0x0b-maze" aria-label="0x0b. maze">0x0b. maze</a>
                </li>
            </ul>
        </div>
    </details>
    
</div>

  <div class="post-content"><h3 id="0x00-simple-unpack">0x00. simple-unpack<a hidden class="anchor" aria-hidden="true" href="#0x00-simple-unpack">#</a></h3>
<p>使用exeinfope脱壳，拖进IDA shift+F12搜索字符串。</p>
<h3 id="0x01-logmein">0x01. logmein<a hidden class="anchor" aria-hidden="true" href="#0x01-logmein">#</a></h3>
<p>反编译得到如下代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">void</span> <span style="color:#66d9ef">__fastcall</span> __noreturn <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> a1, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>a2, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>a3)
{
  size_t v3; <span style="color:#75715e">// rsi
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> i; <span style="color:#75715e">// [rsp+3Ch] [rbp-54h]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">char</span> s[<span style="color:#ae81ff">36</span>]; <span style="color:#75715e">// [rsp+40h] [rbp-50h] BYREF
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v6; <span style="color:#75715e">// [rsp+64h] [rbp-2Ch]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">__int64</span> v7; <span style="color:#75715e">// [rsp+68h] [rbp-28h]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">char</span> v8[<span style="color:#ae81ff">28</span>]; <span style="color:#75715e">// [rsp+70h] [rbp-20h] BYREF
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v9; <span style="color:#75715e">// [rsp+8Ch] [rbp-4h]
</span><span style="color:#75715e"></span>
  v9 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
  strcpy(v8, <span style="color:#e6db74">&#34;:</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">AL_RT^L*.?+6/46&#34;</span>);
  v7 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x65626D61726168LL</span>;
  v6 <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>;
  printf(<span style="color:#e6db74">&#34;Welcome to the RC3 secure password guesser.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
  printf(<span style="color:#e6db74">&#34;To continue, you must enter the correct password.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
  printf(<span style="color:#e6db74">&#34;Enter your guess: &#34;</span>);
  __isoc99_scanf();
  v3 <span style="color:#f92672">=</span> strlen(s);
  <span style="color:#66d9ef">if</span> ( v3 <span style="color:#f92672">&lt;</span> strlen(v8) )
    sub_4007C0();
  <span style="color:#66d9ef">for</span> ( i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> strlen(s); <span style="color:#f92672">++</span>i )
  {
    <span style="color:#66d9ef">if</span> ( i <span style="color:#f92672">&gt;=</span> strlen(v8) )
      sub_4007C0();
    <span style="color:#66d9ef">if</span> ( s[i] <span style="color:#f92672">!=</span> (<span style="color:#66d9ef">char</span>)(<span style="color:#f92672">*</span>((_BYTE <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v7 <span style="color:#f92672">+</span> i <span style="color:#f92672">%</span> v6) <span style="color:#f92672">^</span> v8[i]) )
      sub_4007C0();
  }
  sub_4007F0();
}
</code></pre></div><p>可以看出，flag就是v7，v6，v8经过一定规则生成的字符串，提取出生成flag的逻辑，写成脚本如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">v8<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;:</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">AL_RT^L*.?+6/46&#34;</span>
v7 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ebmarah&#39;</span>[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
s<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(v8)):
    s<span style="color:#f92672">+=</span>chr(ord(v7[i<span style="color:#f92672">%</span><span style="color:#ae81ff">7</span>])<span style="color:#f92672">^</span>ord(v8[i]))
print(s)
</code></pre></div><h3 id="0x02-insanity">0x02. insanity<a hidden class="anchor" aria-hidden="true" href="#0x02-insanity">#</a></h3>
<p>直接拖进IDA，查找字符串。</p>
<h3 id="0x03-python-trade">0x03. python-trade<a hidden class="anchor" aria-hidden="true" href="#0x03-python-trade">#</a></h3>
<p>反编译之后发现有个encode函数，根据函数的逻辑规则写出decode函数如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> base64
buf <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b64decode(<span style="color:#e6db74">&#39;XlNkVmtUI1MgXWBZXCFeKY+AaXNt&#39;</span>)
flag <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> buf:
    i <span style="color:#f92672">-=</span> <span style="color:#ae81ff">16</span>
    i <span style="color:#f92672">^=</span> <span style="color:#ae81ff">32</span>
    flag <span style="color:#f92672">+=</span> chr(i)
print(flag)
</code></pre></div><h3 id="0x04-re1">0x04. re1<a hidden class="anchor" aria-hidden="true" href="#0x04-re1">#</a></h3>
<p>又一个直接查找字符串就能找到flag的题。</p>
<h3 id="0x05-game">0x05. game<a hidden class="anchor" aria-hidden="true" href="#0x05-game">#</a></h3>
<p>打开是个游戏，游戏通关拿到flag（草）</p>
<h3 id="0x06-hello-ctf">0x06. Hello, CTF<a hidden class="anchor" aria-hidden="true" href="#0x06-hello-ctf">#</a></h3>
<p>反编译获得如下代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">int</span> <span style="color:#66d9ef">__cdecl</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>argv, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>envp)
{
  <span style="color:#66d9ef">int</span> i; <span style="color:#75715e">// ebx
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">char</span> v4; <span style="color:#75715e">// al
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> result; <span style="color:#75715e">// eax
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">char</span> Buffer[<span style="color:#ae81ff">2</span>]; <span style="color:#75715e">// [esp+12h] [ebp-5Eh] BYREF
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">char</span> v7[<span style="color:#ae81ff">20</span>]; <span style="color:#75715e">// [esp+14h] [ebp-5Ch] BYREF
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">char</span> v8[<span style="color:#ae81ff">32</span>]; <span style="color:#75715e">// [esp+28h] [ebp-48h] BYREF
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">__int16</span> v9; <span style="color:#75715e">// [esp+48h] [ebp-28h]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">char</span> v10; <span style="color:#75715e">// [esp+4Ah] [ebp-26h]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">char</span> v11[<span style="color:#ae81ff">36</span>]; <span style="color:#75715e">// [esp+4Ch] [ebp-24h] BYREF
</span><span style="color:#75715e"></span>
  strcpy(v11, <span style="color:#e6db74">&#34;437261636b4d654a757374466f7246756e&#34;</span>);
  <span style="color:#66d9ef">while</span> ( <span style="color:#ae81ff">1</span> )
  {
    memset(v8, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">sizeof</span>(v8));
    v9 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    v10 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    printf(aPleaseInputYou);
    scanf(<span style="color:#e6db74">&#34;%s&#34;</span>, v7);
    <span style="color:#66d9ef">if</span> ( strlen(v7) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0x11</span> )
      <span style="color:#66d9ef">break</span>;
    <span style="color:#66d9ef">for</span> ( i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">17</span>; <span style="color:#f92672">++</span>i )
    {
      v4 <span style="color:#f92672">=</span> v7[i];
      <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span>v4 )
        <span style="color:#66d9ef">break</span>;
      sprintf(Buffer, <span style="color:#e6db74">&#34;%x&#34;</span>, v4);
      strcat(v8, Buffer);
    }
    <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span>strcmp(v8, v11) )
      printf(<span style="color:#e6db74">&#34;success!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
    <span style="color:#66d9ef">else</span>
      printf(<span style="color:#e6db74">&#34;wrong!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
  }
  printf(<span style="color:#e6db74">&#34;wrong!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
  result <span style="color:#f92672">=</span> <span style="color:#f92672">--</span>Stream._cnt;
  <span style="color:#66d9ef">if</span> ( Stream._cnt <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> )
    <span style="color:#66d9ef">return</span> _filbuf(<span style="color:#f92672">&amp;</span>Stream);
  <span style="color:#f92672">++</span>Stream._ptr;
  <span style="color:#66d9ef">return</span> result;
}
</code></pre></div><p>阅读代码后发现就是将输入的字符串转换为16进制存储，再与给定字符串比较。</p>
<p>因此可以根据给定字符串推导出flag。</p>
<h3 id="0x07-open-source">0x07. open-source<a hidden class="anchor" aria-hidden="true" href="#0x07-open-source">#</a></h3>
<p>题目直接给出了源代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[]) {
    <span style="color:#66d9ef">if</span> (argc <span style="color:#f92672">!=</span> <span style="color:#ae81ff">4</span>) {
    	printf(<span style="color:#e6db74">&#34;what?</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
    	exit(<span style="color:#ae81ff">1</span>);
    }

    <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> first <span style="color:#f92672">=</span> atoi(argv[<span style="color:#ae81ff">1</span>]);
    <span style="color:#66d9ef">if</span> (first <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0xcafe</span>) {
    	printf(<span style="color:#e6db74">&#34;you are wrong, sorry.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
    	exit(<span style="color:#ae81ff">2</span>);
    }

    <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> second <span style="color:#f92672">=</span> atoi(argv[<span style="color:#ae81ff">2</span>]);
    <span style="color:#66d9ef">if</span> (second <span style="color:#f92672">%</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">||</span> second <span style="color:#f92672">%</span> <span style="color:#ae81ff">17</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">8</span>) {
    	printf(<span style="color:#e6db74">&#34;ha, you won&#39;t get it!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
    	exit(<span style="color:#ae81ff">3</span>);
    }

    <span style="color:#66d9ef">if</span> (strcmp(<span style="color:#e6db74">&#34;h4cky0u&#34;</span>, argv[<span style="color:#ae81ff">3</span>])) {
    	printf(<span style="color:#e6db74">&#34;so close, dude!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
    	exit(<span style="color:#ae81ff">4</span>);
    }

    printf(<span style="color:#e6db74">&#34;Brr wrrr grr</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> hash <span style="color:#f92672">=</span> first <span style="color:#f92672">*</span> <span style="color:#ae81ff">31337</span> <span style="color:#f92672">+</span> (second <span style="color:#f92672">%</span> <span style="color:#ae81ff">17</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">11</span> <span style="color:#f92672">+</span> strlen(argv[<span style="color:#ae81ff">3</span>]) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1615810207</span>;

    printf(<span style="color:#e6db74">&#34;Get your key: &#34;</span>);
    printf(<span style="color:#e6db74">&#34;%x</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, hash);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}
</code></pre></div><p>根据规则构造payload即可获取flag。</p>
<h3 id="0x08-no-strings-attached">0x08. no-strings-attached<a hidden class="anchor" aria-hidden="true" href="#0x08-no-strings-attached">#</a></h3>
<p>打开来发现是一个非常大的程序：</p>
<p><img loading="lazy" src="1.png" alt="1"  />
</p>
<p>注意到最后一个函数<code>authenticate</code>可能是验证输入的flag是否正确，打开后如下：</p>
<p><img loading="lazy" src="2.png" alt="2"  />
</p>
<p>看样子是要比较ws和s2的值是否一致，而s2是由decrypt函数生成的：</p>
<p><img loading="lazy" src="3.png" alt="3"  />
</p>
<p>生成flag的算法看起来挺复杂，懒得写了，故采用动态调试。阅读汇编代码可知，decrypt函数结束后，返回值存在eax中。</p>
<p>用gdb再decrypt函数处下个断点，程序运行至decrypt处停下，再往前运行一步，再结束运行此函数，此时eax寄存器存储的值就是flag。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span>b decrypt
<span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span>n
<span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span>finish
<span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span>x/6sw $eax
</code></pre></div><p><img loading="lazy" src="4.png" alt="4"  />
</p>
<h3 id="0x09-csaw2013reversing2">0x09. csaw2013reversing2<a hidden class="anchor" aria-hidden="true" href="#0x09-csaw2013reversing2">#</a></h3>
<p>打开来发现有一个窗体，弹出了一坨乱码：
<img loading="lazy" src="5.png" alt="5"  />
</p>
<p>打开IDA查看程序逻辑：</p>
<p><img loading="lazy" src="6.png" alt="6"  />
</p>
<p>发现程序存在反调试<code>IsDebuggerPresent</code>。</p>
<p>跳过反调试，将<code>jnz short loc_401096</code>改为<code>jmp short loc_401096</code>，绕过反调试检查。</p>
<p>再将<code>int 3 ;Trap to Debugger</code>改为<code>nop</code>去掉这个中断。</p>
<p>再跳转回原来的弹窗输出flag。</p>
<blockquote>
<p>Patch Program的方法：Edit-&gt;Patch Program-&gt;Assemble</p>
<p>全部更改完成后，点击Edit-&gt;Patch Program-&gt;Apply patches to input file</p>
</blockquote>
<h3 id="0x0a-getit">0x0a. getit<a hidden class="anchor" aria-hidden="true" href="#0x0a-getit">#</a></h3>
<p>拖进IDA看见如下代码：</p>
<p><img loading="lazy" src="7.png" alt="7"  />
</p>
<p>分析逻辑之后发现t的值就是flag，可以直接根据逻辑写exp，不过我这里使用动态调试的方法。</p>
<p>在for循环的第一个函数处下个断点，之后直接查看t的值。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span>b fseek
<span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span>r
<span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span>x/6 0x6010e0#t的地址
</code></pre></div><p><img loading="lazy" src="8.png" alt="8"  />
</p>
<p>成功获取flag。</p>
<h3 id="0x0b-maze">0x0b. maze<a hidden class="anchor" aria-hidden="true" href="#0x0b-maze">#</a></h3>
<p><a href="https://www.cnblogs.com/YenKoc/p/12779944.html">XCTF reverse maze - YenKoc - 博客园 (cnblogs.com)</a></p>


  </div>

  <footer class="post-footer">
<nav class="paginav">
  <a class="next" href="https://zeroy.site/articles/basic_RSA/">
    <span class="title"> »</span>
    <br>
    <span>RSA算法详解</span>
  </a>
  
</nav>

  </footer><script src="https://utteranc.es/client.js"
        repo="zeroy0410/zeroy0410.github.io"
        issue-term="pathname"
        label="Comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://zeroy.site/">zeroy&#39;s blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script></body>

</html>
